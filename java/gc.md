# Garbage Collectorë€? (GC)

`Garbage Collection` ìë°”ì—ì„œ ì“°ë ˆê¸°ëŠ” ê°ì²´ì…ë‹ˆë‹¤.   
í•˜ë‚˜ì˜ ê°ì²´ëŠ” ë©”ëª¨ë¦¬ë¥¼ ì ìœ í•˜ê³ , í•„ìš”í•˜ì§€ ì•Šìœ¼ë©´ ë©”ëª¨ë¦¬ì—ì„œ í•´ì œë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ë©”ëª¨ë¦¬ ì ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‰½ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ì½”ë“œì—ì„œ aë¼ëŠ” ê°ì²´ê°€ ë§Œë“¤ì–´ì ¸ ë©”ëª¨ë¦¬ì˜ í•œë¶€ë¶„ì„ ì ìœ í•˜ê²Œ ë˜ê³ ,  
íŠ¹ì • ë©”ì†Œë“œ í˜¸ì¶œí•œ í›„ ìˆ˜í–‰ì´ ì™„ë£Œë˜ì–´ í•´ë‹¹ ê°ì²´ê°€ ë”ì´ìƒ í•„ìš”ì—†ëŠ” ê°ì²´, ì“°ë ˆê¸°ê°€ ë©ë‹ˆë‹¤.   
ì´ **ì“°ë ˆê¸° ê°ì²´ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ì‘ì—…ì„ GC**ë¼ê³  í•©ë‹ˆë‹¤.

> Javaë‚˜ Kotlinì—ì„œëŠ” ì´ëŸ¬í•œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€ë¥¼ ìœ„í•´ ê°€ë¹„ì§€ì»¬ë ‰í„°(Garbage Collector, GC)ê°€ ì£¼ê¸°ì ìœ¼ë¡œ ê²€ì‚¬í•˜ì—¬ ë©”ëª¨ë¦¬ë¥¼ ì²­ì†Œí•´ì¤€ë‹¤.  
ë¬¼ë¡  Javaì—ì„œë„ `System,gc()`ë¥¼ ì´ìš©í•˜ì—¬ í˜¸ì¶œí•  ìˆ˜ ìˆì§€ë§Œ,  
í•´ë‹¹ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì€ ì‹œìŠ¤í…œ ì„±ëŠ¥ì— ë§¤ìš° í° ì˜í–¥ì„ ë¯¸ì¹˜ê¸° ë•Œë¬¸ì— ì ˆëŒ€ í˜¸ì¶œí•´ì„  ì•ˆëœë‹¤.

ìœ ë‹‰ìŠ¤ ì„œë²„ë“  ìœˆë„ìš° ê¸°ë°˜ ì„œë²„ë“  í’€(Full) GCë¥¼ ìˆ˜í–‰í•˜ëŠ” ì‹œì ì—ëŠ” í•´ë‹¹ WASì˜ ì»¨í…Œì´ë„ˆì—ì„œ ì„œë¹„ìŠ¤ê°€ ì²˜ë¦¬ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.  
ë‹¤ì‹œ ì´ì•¼ê¸°í•˜ë©´ **GCë¥¼ ë§ì´í•˜ë©´í• ìˆ˜ë¡ ì‘ë‹µ ì‹œê°„ì— ë§ì€ ì˜í–¥ì„ ë¼ì¹œë‹¤ëŠ” ê²ƒ**ì…ë‹ˆë‹¤.   
ê·¸ëŸ¬ë¯€ë¡œ **ìì‹ ì´ ë§Œë“  ìë°” í”„ë¡œê·¸ë¨ì˜ ì„±ëŠ¥ì„ ìƒê°í•˜ëŠ” ìë°” ì—”ì§€ë‹ˆì–´ë¼ë©´, GCê°€ ì–´ë–»ê²Œ ì²˜ë¦¬ë˜ëŠ”ì§€ ê¸°ë³¸ ì§€ì‹ì€ ê°–ê³  ìˆì–´ì•¼ ê² ì£ ?**

### GCì˜ ì›ë¦¬ë¥¼ ì•Œì•„ë³´ì
1. ë©”ëª¨ë¦¬ í• ë‹¹
2. ì‚¬ìš©ì¤‘ì¸ ë©”ëª¨ë¦¬ ì¸ì‹
3. ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë©”ëª¨ë¦¬ ì¸ì‹

GCë¥¼ í•´ë„ **ë”ì´ìƒ ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ëª¨ë¦¬ ì˜ì—­ì´ ì—†ëŠ”ë° ê³„ì† ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹**í•˜ë ¤ê³  í•˜ë©´, `OutOfMemoryError`ê°€ ë°œìƒí•˜ì—¬ WASê°€ ë‹¤ìš´ë  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.  
í–‰(Hang) ì¦‰, ì„œë²„ê°€ ìš”ì²­ì„ ì²˜ë¦¬ ëª»í•˜ê³  ìˆëŠ” ìƒíƒœê°€ ë©ë‹ˆë‹¤.

JVMì˜ ë©”ëª¨ë¦¬ëŠ” í¬ê²Œ `í´ë˜ìŠ¤ ì˜ì—­, ìë°” ìŠ¤íƒ, í™, ë„¤ì´í‹°ë¸Œ ë©”ì†Œë“œ ìŠ¤íƒ`ì˜ 4ê°œ ì˜ì—­ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.  
**ê°€ë¹„ì§€ ì»¬ë ‰í„°ì—ì„œëŠ” í™ ë©”ëª¨ë¦¬ë¥¼ ë‹¤ë£¨ê²Œ ë©ë‹ˆë‹¤**.  
ì¦‰ **ìë°” ê°€ë¹„ì§€ ì»¬ë ‰í„°ê°€ ì¸ì‹í•˜ê³  í• ë‹¹í•˜ëŠ” ìë°” ë©”ëª¨ë¦¬ ì˜ì—­ì€ í™ ì˜ì—­**ì¸ê²ƒì…ë‹ˆë‹¤.

![](../img/gc-jvm-heap.png)

JVM Heapì€ `Young, Old, Perm` ì„¸ ì˜ì—­ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.  
ì´ì¤‘ `Perm`ì€ **ê±°ì˜ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì˜ì—­ìœ¼ë¡œ í´ë˜ìŠ¤ì™€ ë©”ì†Œë“œ ì •ë³´ì™€ ê°™ì´ ìë°” ì–¸ì–´ ë ˆë²¨ì—ì„œ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤**.  
`Young, Old`ì˜ì—­ ê·¸ë¦¬ê³  `Young`ì˜ì—­ì€ `Eden`ì˜ì—­ì™€ ë‘ê°œì˜ `Survivor`ì˜ì—­ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.  
ìš°ë¦¬ê°€ ê³ ë ¤í•´ì•¼ í•  ìë°”ì˜ ë©”ëª¨ë¦¬ ì˜ì—­ì€ ì´ 4ê°œì˜ ì˜ì—­ìœ¼ë¡œ ë‚˜ë‰œë‹¤ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
>  ( Young (1. Eden, 2. Survivor 1, 3. Survivor 2), Old (4. ë©”ëª¨ë¦¬) )


![](../img/java-memory-management.png)

ì¼ë‹¨ ë©”ëª¨ë¦¬ì— ê°ì²´ê°€ ìƒì„±ë˜ë©´, `Eden ì˜ì—­ì— ê°ì²´ê°€ ì§€ì •`ë©ë‹ˆë‹¤.   
**Eden ì˜ì—­ì— ë°ì´í„°ê°€ ì–´ëŠ ì •ë„ ìŒ“ì´ë©´, ì´ ì˜ì—­ì— ìˆë˜ ê°ì²´ê°€ ì–´ë””ë¡ ê°€ ì˜®ê²¨ì§€ê±°ë‚˜ ì‚­ì œ**ë©ë‹ˆë‹¤.  
`ì´ ë•Œ ì˜®ê²¨ê°€ëŠ” ìœ„ì¹˜ê°€ survivor ì˜ì—­`ì…ë‹ˆë‹¤.  
**ë‘ê°œì˜ Survivor ì˜ì—­ ì‚¬ì´ì— ìš°ì„  ìˆœìœ„ê°€ ìˆëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.**  
**í•˜ì§€ë§Œ, ì´ ë‘ ê°œì˜ ì˜ì—­ ì¤‘ í•œ ì˜ì—­ì€ ë°˜ë“œì‹œ ë¹„ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.**  
`ê·¸ ë¹„ì–´ìˆëŠ” ì˜ì—­ì— Eden ì˜ì—­ì— ìˆë˜ ê°ì²´ê°€ í• ë‹¹`ë©ë‹ˆë‹¤.

Edenì—ì„œ survivor ë‘˜ ì¤‘ í•˜ë‚˜ì˜ ì˜ì—­ìœ¼ë¡œ í• ë‹¹ ë˜ê³ ,  í• ë‹¹ëœ Survivor ì˜ì—­ì´ ì°¨ë©´, GCê°€ ë˜ë©´ì„œ  
Eden ì˜ì—­ì— ìˆëŠ” ê°ì²´ì™€ ê½‰ ì°¬ Survivor ì˜ì—­ì— ìˆëŠ” ê°ì²´ê°€ ë¹„ì–´ ìˆëŠ” Survivor ì˜ì—­ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.  
ê·¸ëŸ¬ë‹¤ê°€ ë” í° ê°ì²´ê°€ ìƒì„±ë˜ê±°ë‚˜,  
**ë” ì´ìƒ Young ì˜ì—­ì— ê³µê°„ì´ ë‚¨ì§€ ì•Šìœ¼ë©´ ê°ì²´ë“¤ì€ Old ì˜ì—­ìœ¼ë¡œ ì´ë™**í•˜ê²Œ ë©ë‹ˆë‹¤.

### GCì˜ ì¢…ë¥˜
* ë§ˆì´ë„ˆ GC : Young ì˜ì—­ì—ì„œ ë°œìƒí•˜ëŠ” GC
* ë©”ì´ì € GC : Old ì˜ì—­ì´ë‚˜ Perm ì˜ì—­ì—ì„œ ë°œìƒí•˜ëŠ” GC

ì´ ë‘ê°€ì§€ GCê°€ ì–´ë–»ê²Œ ìƒí˜¸ ì‘ìš©í•˜ëŠëƒì— ë”°ë¼ì„œ GC ë°©ì‹ì— ì°¨ì´ê°€ ë‚˜ë©°,  ì„±ëŠ¥ì—ë„ ì˜í–¥ì„ ì¤ë‹ˆë‹¤.  
**GCê°€ ë°œìƒí•˜ê±°ë‚˜ ê°ì²´ê°€ ê° ì˜ì—­ì—ì„œ ë‹¤ë¥¸ ì˜ì—­ìœ¼ë¡œ ì´ë™í•  ë•Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³‘ëª©ì´ ë°œìƒí•˜ë©´ì„œ ì„±ëŠ¥ì— ì˜í–¥**ì„ ì£¼ê²Œ ë©ë‹ˆë‹¤.  
ê·¸ë˜ì„œ í•« ìŠ¤íŒŸ(Hot Spot) JVMì—ì„œëŠ” ìŠ¤ë ˆë“œ ë¡œì»¬ í• ë‹¹ ë²„í¼(TLABs: Thread-Local Allocation Buffers)ë¼ëŠ” ê²ƒì„ ì‚¬ìš©í•©ë‹ˆë‹¤.  
ì´ë¥¼ í†µí•´ **ê° ìŠ¤ë ˆë“œë³„ ë©”ëª¨ë¦¬ ë²„í¼ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ” ë©”ëª¨ë¦¬ í• ë‹¹ ì‘ì—…ì´ ê°€ëŠ¥**í•©ë‹ˆë‹¤.

![](../img/gc-thread-buffer.png)

### 4ê°€ì§€ GC ë°©ì‹
> `JDK 5.0ì´ìƒ`ì—ì„œ ì§€ì›í•˜ëŠ” GC ë°©ì‹ì—ëŠ” ë„¤ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤. 
WASë‚˜ ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ ìˆ˜í–‰ì‹œ ì˜µì…˜ì„ ì§€ì •í•˜ì—¬ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. Serial Collector (ì´í•˜ ì‹œë¦¬ì–¼ ì½œë ‰í„°)
2. Parallel Collector (ì´í•˜ ë³‘ë ¬ ì½œë ‰í„°)
3. Parallel Compacting Collector (ì´í•˜ ë³‘ë ¬ ì»´íŒ©íŒ… ì½œë ‰í„°)
4. Concurrent Mark-Sweep (CMS) Collector (ì´í•˜ CMS ì½œë ‰í„°)

> [ğŸ™ì°¸ê³ í•˜ì˜€ìŠµë‹ˆë‹¤ğŸ™](https://12bme.tistory.com/57)